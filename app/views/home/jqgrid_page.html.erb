



<% stylesheetHead 'bootstrap.min' %>
<% stylesheetHead 'font-awesome.min' %>
<% stylesheetHead 'ionicons.min' %>
<% stylesheetHead 'datatables/dataTables.bootstrap' %>
<% stylesheetHead 'radiologist' %>
<% stylesheetHead 'jquery.multiselect' %>
<% stylesheetHead 'jqgrid_style/ui.jqgrid' %>
<% stylesheetHead 'jquery-ui' %>
<% stylesheetHead 'AdminLTE' %>
<% stylesheetHead 'custom_popup' %>


<%-# javascriptHead 'jquery.min' -%>

<% content_for :head_javascript_section do %>
	<style>
		table#example1 tbody tr td:first-child a{
			color:skyblue;
		}
		
		#fbox_example1 table tbody tr td.columns select{
			max-width:160px;
		}
		
	</style>
  <script type='text/javascript'>
  $(document).ready(function () {
  	
            $("#example1 tr td:first-child a").click(function (e) {
                e.preventDefault();
                $("#PopupDiv").modal('show');
            });


        });
  </script>
 <% end %>

<!-- Right side column. Contains the navbar and content of the page -->
        <aside class="right-side">
            <!-- Content Header (Page header) -->
            <section class="content-header">
                <h1>JQ Grid<small></small> </h1>
                <ol class="breadcrumb">
                    <li><a href="/"><i class="fa fa-home"></i>Home</a></li>
                    <li class="active">JQ Grid Page</li>
                </ol>
            </section>
            
<!-- Main content -->
            <section class="content">
                <div class="row">
                    <div class="col-xs-12" style=" text-align: center;">
                        <div>
                        	<div class="col-xs-4">
                                <select id="DdlAccessionIdSrch" title="Basic example" multiple="multiple" name="example-basic" size="5">
                                </select>
                            </div>
                            <div class="col-xs-4" >
                                <select id="DdlStatusSrch" title="Basic example" multiple="multiple" name="example-basic" >
                                    <option value="status_1">Delay</option>
                                    <option value="status_2">InProgress</option>
                                    <option value="status_3">Final</option>
                                </select>
                            </div> 
							<div class="col-xs-4" style=" text-align: left;">
								<input type="button" id="BtnFilter" value="Filter" />
							</div>
                            
                        </div>
                    </div>
                    <br />
                    <br />
                    <div class="col-xs-12">
                        <div class="box">
                            <!--<div class="box-header">
              <h3 class="box-title">Data Table With Full Features</h3>
            </div>-->
                            <!-- /.box-header -->
                            <div class="box-body table-responsive">
                                <table id="example1" class="table table-bordered table-striped">
                                </table>
                                <div id="example1pager"></div>
                            </div>
                            <!-- /.box-body -->
                        </div>

                        <!-- /.box -->
                    </div>
                </div>



            </section>
            <!-- /.content -->
            
    

<!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>-->

<% javascriptBody 'jquery.min.js' %>
<% javascriptBody 'bootstrap.min' %>

<%-# javascriptBody 'plugins/datatables/jquery.dataTables' -%>
<%-# javascriptBody 'plugins/datatables/dataTables.bootstrap' -%>
<% javascriptBody 'AdminLTE/app' %>

<% javascriptBody 'jquery-ui-1.10.3.min' %>
<% javascriptBody 'jquery.multiselect' %>

<% content_for :body_javascript_section do %>
<%= javascript_include_tag 'jqgrid/grid.locale-en.js' %>
<%= javascript_include_tag 'jqgrid/jquery.jqGrid.js' %>

  <script type='text/javascript'>
  $(document).ready(function(){
  	
  	var ddlAccessionSrch_Var = $("#DdlAccessionIdSrch").multiselect({
        							noneSelectedText: "Select Accession"
     							});
  	var ddlStatusSrch_Var = $("#DdlStatusSrch").multiselect({
        						noneSelectedText: "Select Status"
     						});
    
            
  	//========Search functionality=================
  	$("#BtnFilter").click(function(){
  		var ddlAccessionIdSelectedValues_Var = $("#DdlAccessionIdSrch").val();
  		var ddlStatusSelectedValues_Var = $("#DdlStatusSrch").val();
  		
  		debugger;
		$.ajax({
  			url:'/home/search_exams',
  			type:'POST',
  			dataType:'json',
  			//contentType: "application/json; charset=utf-8",
  			data:{
  				accession_ids: ddlAccessionIdSelectedValues_Var,
  				exam_status: ddlStatusSelectedValues_Var,
  				authenticity_token: window._token
  			},
  			success:function(data){
  				debugger;
  			},
  			error:function(data){
  				debugger;
  			}
  		});
  	});
  	//=====End Search functionality==============
  	
  	$.ajax({
  		url:"/home/get_data",
  		//dataType: 'json',
  		contentType: "application/json; charset=utf-8",
  		success:function(data){
  			debugger;
  		},
  		error:function(data){
  			debugger;
  		}
  		
  	});
  	
  	
  	function makeIdAsLinkFormatter( cellvalue, option, rowobj ){
  		//debugger;
  		return '<a class="" id="lnk$#'+ cellvalue +'" onclick="showExamDetail(this.id)">' + cellvalue + '</a>';
  	}
  	
  	function parseStatusOfExamFormatter (cellvalue, option, rowobj ) {
		//debugger;
		return '<div class="wizard"><a class="'+cellvalue.initialstage+'"><span class="badge"></span></a><a class="'+cellvalue.patclass+'"><span class="badge"></span></a><a class="'+cellvalue.appttime+'"><span class="badge badge-inverse"></span></a><a class="'+cellvalue.scheduledstop+'"><i class="fa fa-check" style="display: table-cell; float: right; margin: 8px;"></i></a></div>'   
	  }
  	
  	
  	//$('#reqgrid').html('').append('<table id="tblUsersGrid" class="scroll"></table> <div id="UsersGridPager" class="scroll text-center"></div>');
        $("#example1").jqGrid({
            datatype: "json",
            url: '/home/get_jqgrid/',
            mtype: 'GET',
            colNames: ['A#','MRN','Proc Code','Proc Description','Modality'],
            colModel: [
                { name: 'accession', index: 'accession', align: 'center', width:35, formatter: makeIdAsLinkFormatter }
                ,{ name: 'mrn', index: 'mrn', align: 'center'}
                ,{ name: 'code', index: 'code', align: 'center'}
                ,{ name: 'description', index: 'description', align: 'center'}
                ,{ name: 'modality', index: 'modality', align: 'center'}
                
            ],
            //jsonReader: { repeatitems:false, root:"rows" },
            //jsonReader: { repeatitems: false, id: "id", root: "rows", page: "page", total: "total",
    //records: "records"
			//},
            jsonReader: { repeatitems: false, id: "id", root: function (obj) { return obj.rows; }, page: function (obj) { return obj.page; }, total: function (obj) { return obj.total; },
    records: function (obj) { return (obj.rows.length ); }
			},
			beforeSelectRow: function() { return false; },
            multiselect: false,
            autowidth: true,
            //width:'90%',
            scrollOffset: 0,
            rowNum: 5,
            rowList: [5, 10, 15, 20],
            height: '250',
            sortname: 'Id',
            sortorder: "asc",
            viewrecords: true,
            ignoreCase: true,
            pager: '#example1pager',
            caption: "Exam Details",
            rownumbers: true,
            loadonce:true,
            loadComplete: function (data) {
            	//debugger;
                var datacount = $("#example1").getGridParam("reccount");
                if (datacount == 0) {
                    $('.ui-jqgrid-bdiv').removeClass('JqgridAutoHeight'); 
                    $('#example1').jqGrid('setGridHeight','250'); 
                }
                if (datacount > 0) {   /*grid heigth */
               	debugger;
					$('#example1').jqGrid('setGridHeight','auto');
                    //$('.ui-jqgrid-bdiv').addClass('JqgridAutoHeight');
                }
                
                //****Binding data to AccessionId dropdown****//
                $("#DdlAccessionIdSrch").empty();
                $.each(data.rows,function(index, value){
                	debugger;
                	$("#DdlAccessionIdSrch").append($('<option>', { value: value.accession, text: value.accession }));
                });
                ddlAccessionSrch_Var.multiselect('refresh');
                //****End Binding data to AccessionId dropdown****//
            },
        }).hideCol([ ]).navGrid('#example1pager', {
            edit: false, add: false, del: false, search: true, refresh: true, beforeRefresh: function () {
                //$("#tblUsersGrid").setGridParam({ postData: { pageXL: '_pageXL' } });
                //$('#pg_UsersGridPager table:eq(1) tr td.nRCls').remove();
            }, afterRefresh: function () {
                //$('#SearchGridPager table:eq(1) tr td.nRCls').remove();
            }
        },
       {}, {}, {}, {
           width: 500, onSearch: function () {
               //$('#pg_UsersGridPager table:eq(1) tr td.nRCls').remove();
               //if ($('#pg_UsersGridPager table:eq(1) tr td.nRCls').length == 0 && $('#fbox_tblUsersGrid').find(':input').eq(2).val() != "") {
                   //$('#pg_UsersGridPager table:eq(1) tr').append('<td class="nRCls"><span class="fntSiz11">Filtered Results Shown. Click on Refresh Data to clear filter.</span></td>');
               //}
               //if ($('#fbox_tblUsersGrid').find(':input').eq(2).val() != "") {
                   //$('.ui-jqdialog-titlebar-close:eq(0)').click();
               //}
           },
           onReset: function () {
               //$('#pg_UsersGridPager table:eq(1) tr td.nRCls').remove();
           }, sopt: ['cn', 'nc']
       });
            

            
            
  });
  
  function showExamDetail(id) {
		debugger;
	  }

  </script>
<% end %>  

